///////////////////////////////////////////////////////////////////////////////////MODULES
const express = require('express');
const morgan = require('morgan');
const chalk = require('chalk');
const path = require('path');
////////////////////////////////////////////////////////////////////////////ROUTER MODULES
const deviceRouter = require('./routers/device');
const connectionRouter = require('./routers/connection');
const notFound = require('./middleware/notFound');
////////////////////////////////////////////////////////////////////////////////////////DB
require('./db/mongoose');
//////////////////////////////////////////////////////////////////////////////EXPRESS PORT
const PORT = process.env.PORT || 5000;
///////////////////////////////////////////////////////////////////////////////EXPRESS APP
const app = express();
///////////////////////////////////////////////////////////////////////////////MIDDLEWARES
app.use(express.json());
app.use(morgan('dev'));
///////////////////////////////////////////////////////////////////////////////////ROUTERS
app.use('/api', deviceRouter);
app.use('/api', connectionRouter);
///////////////////////////////////////////////////////////////SERVE STATIC ASSETS IN PROD
// Set the static folder
app.use(express.static(path.join(__dirname, '../client/build')));

app.get('*', (request, response) => {
  response.sendFile(path.resolve(__dirname, '../client', 'build', 'index.html'));
});
////////////////////////////////////////////////////////////////////////////ERROR HANDLERS
app.use(notFound);
////////////////////////////////////////////////////////////////////////////////////LISTEN
app.listen(PORT, () => console.log(`Listening on port ${chalk.yellow(PORT)}`));
//////////////////////////////////////////////////////////////////////////////////////////
